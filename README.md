# fe-excel-download-example

前端使用 post 请求下载 excel 文件的用例

## 目的

后端本来的处理逻辑为将 excel 文件上传云端，生成 url，通过请求返回，前端再通过 url 获取文件

由于需要上传云端，降低了响应时间

想要通过直接返回二进制文件提高响应时间

## 使用

```js
npm install

node index.js
```

## 问题

post 响应二进制文件能够实现文件下载，但存在一些问题

1. 下载文件没有进度条

    不同于 get 请求，post 请求不使用浏览器默认下载处理，而是在请求后在浏览器中将二进制文件组装成文件，因此不会出现下载文件的默认进度条
   
2. responseType 固定为 blob 不能同时支持 json

    下载文件时必须在请求头中设置 `responseType = 'blob'` 用来接收二进制文件，这样的话就需要与本来封装的业务接口区分开，包括拦截器与错误处理
    
3. 处理复杂

    需要在浏览器端接收二进制文件 然后挂载到 `<a>` 标签上，触发点击事件进行下载，需要很多额外逻辑
    
    最重要的是二进制文件的转化过程中不可调试，不容易排查问题
    
## 疑问

是否可以在后端本地生成临时 url，当请求过后将本地临时文件删除

## 其他

成熟工具库 

[FileSaver](https://github.com/eligrey/FileSaver.js)
